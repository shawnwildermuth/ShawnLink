(function(){"use strict";var e={7123:function(e,n,t){var l=t(9242),r=t(3396),i=t(7139);const o={class:"bg-gray-50 text-gray-900 w-full"},a=(0,r.Uk)("Admin"),s=(0,r.Uk)("List"),u=(0,r.Uk)("New"),d=(0,r.Uk)("Reports"),c=(0,r.Uk)("Test"),m=(0,r.Uk)("Logout"),f={class:""},p=(0,r._)("i",{class:"fas fa-spin fa-spinner"},null,-1),y={class:""},v={class:""};function k(e,n,t,l,k,h){const b=(0,r.up)("v-toolbar-title"),w=(0,r.up)("v-btn"),g=(0,r.up)("v-toolbar-items"),_=(0,r.up)("v-toolbar"),E=(0,r.up)("v-alert"),U=(0,r.up)("router-view");return(0,r.wg)(),(0,r.iD)("div",o,[(0,r.Wm)(_,null,{default:(0,r.w5)((()=>[(0,r.Wm)(b,null,{default:(0,r.w5)((()=>[a])),_:1}),(0,r.Wm)(g,null,{default:(0,r.w5)((()=>[(0,r.Wm)(w,{to:"/"},{default:(0,r.w5)((()=>[s])),_:1}),(0,r.Wm)(w,{to:"/editor",class:"button"},{default:(0,r.w5)((()=>[u])),_:1}),(0,r.Wm)(w,{to:"/summaries",class:"button"},{default:(0,r.w5)((()=>[d])),_:1}),(0,r.Wm)(w,{href:"/"},{default:(0,r.w5)((()=>[c])),_:1}),(0,r.Wm)(w,{href:"/signout-oidc",class:"button"},{default:(0,r.w5)((()=>[m])),_:1})])),_:1})])),_:1}),(0,r._)("div",f,[e.error?((0,r.wg)(),(0,r.j4)(E,{key:0,color:"danger"},{default:(0,r.w5)((()=>[(0,r.Uk)((0,i.zw)(e.error),1)])),_:1})):(0,r.kq)("",!0),e.isBusy?((0,r.wg)(),(0,r.j4)(E,{key:1,color:"info"},{default:(0,r.w5)((()=>[p,(0,r.Uk)(" "+(0,i.zw)(e.busyMessage),1)])),_:1})):(0,r.kq)("",!0),(0,r._)("div",y,[(0,r._)("div",v,[(0,r.Wm)(U)])])])])}var h=t(4870),b=t(6265),w=t.n(b);const g={isBusy:(0,h.iH)(!1),busyMessage:(0,h.iH)(""),error:(0,h.iH)(""),links:(0,h.iH)([]),isLoaded:(0,h.iH)(!1),async loadLinks(){this.setBusy("Loading Links..."),this.clearError();try{var e=await w().get("/api/links");this.links.value=e.data,this.isLoaded.value=!0}catch(n){console.error(n),this.setError("Failed to load links")}finally{this.clearBusy()}},async loadSummaries(){this.setBusy("Loading Report"),this.clearError();try{var e=await w().get("/api/links/summary");return e.data}catch(n){console.error(n),this.setError("Failed to load report")}finally{this.clearBusy()}},setError(e){this.error.value=e},clearError(){this.error.value=""},setBusy(e){this.isBusy.value=!0,e&&(this.busyMessage.value=e)},clearBusy(){this.isBusy.value=!1,this.busyMessage.value=""}};var _=g,E={setup(){return{..._}}},U=t(89);const H=(0,U.Z)(E,[["render",k]]);var L=H,W=t(678);const D=(0,r._)("h2",null,"Links Management",-1),S={class:"-table-collapse -w-full"},C={colspan:"6",class:"-bg-slate-800 -text-white -p-1"},B=(0,r.Uk)(" Domain: "),K=(0,r._)("tr",null,[(0,r._)("th"),(0,r._)("th",null,"Key"),(0,r._)("th",null,"Destination"),(0,r._)("th",null,"Link"),(0,r._)("th")],-1),x=(0,r._)("td",null,"Â ",-1),O={class:"-border -border-gray-300 -p-1"},j={class:"-border -border-gray-300 -p-1"},V=["href","title"],$={class:"-border -border-gray-300 -p-1"},z=["href"],M={class:"-border -border-gray-300 -p-1"},q=(0,r.Uk)("Edit"),N=(0,r.Uk)(" Delete "),T=(0,r.Uk)(" Copy "),F=(0,r._)("pre",null,"    \r\n  ",-1);function Y(e,n,t,l,o,a){const s=(0,r.up)("v-btn");return(0,r.wg)(),(0,r.iD)(r.HY,null,[(0,r._)("div",null,[D,(0,r._)("table",S,[(0,r._)("tbody",null,[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(l.links,(e=>((0,r.wg)(),(0,r.iD)(r.HY,{key:e},[(0,r._)("tr",null,[(0,r._)("td",C,[B,(0,r._)("strong",null,(0,i.zw)(e.domain),1)])]),K,((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(e.links,(e=>((0,r.wg)(),(0,r.iD)("tr",{key:e,class:"hover:-bg-slate-100"},[x,(0,r._)("td",O,(0,i.zw)(e.key),1),(0,r._)("td",j,[(0,r._)("a",{href:e.url,title:e.url},(0,i.zw)(l.shorten(e.url)),9,V)]),(0,r._)("td",$,[(0,r._)("a",{href:`https://${e.domain}/${e.key}`},(0,i.zw)(`https://${e.domain}/${e.key}`),9,z)]),(0,r._)("td",M,[(0,r.Wm)(s,{to:{name:"EditLink",params:{editKey:e.key,domain:e.domain}},color:"green",variant:"plain"},{default:(0,r.w5)((()=>[q])),_:2},1032,["to"]),(0,r.Wm)(s,{color:"red",variant:"plain",onClick:n=>l.deleteLink(e)},{default:(0,r.w5)((()=>[N])),_:2},1032,["onClick"]),(0,r.Wm)(s,{color:"grey",variant:"plain",onClick:n=>l.copyToClipboard(e)},{default:(0,r.w5)((()=>[T])),_:2},1032,["onClick"])])])))),128))],64)))),128))])])]),F],64)}var R={name:"Home",setup(){async function e(e){if(navigator.clipboard)try{await navigator.clipboard.writeText(`https://${e.domain}/${e.key}`)}catch{_.setError("Failed to copy to clipboard: Exception thrown")}else _.setError("Failed to copy to clipboard: Not supported")}async function n(e){_.setBusy("Deleting Links..."),_.clearError();try{const n=await w()["delete"](`/api/links/${e.domain}/${e.key}`);if(200===n.status){const n=_.links.value.findIndex((e=>e.domain));if(n<0)throw"Bad Domain Group while deleting item";const t=_.links.value[n],l=t.links.indexOf(e);l>-1&&t.links.splice(l,1),0===t.links.length&&_.links.value.splice(n,1)}}catch{_.setError(`Could not delete ${e.key}`)}finally{_.clearBusy()}}function t(e){const n=e.split("/",3).join("/").length;return e.substring(0,n)+"/..."}return(0,r.bv)((()=>_.loadLinks())),{links:_.links,copyToClipboard:e,deleteLink:n,shorten:t}}};const Z=(0,U.Z)(R,[["render",Y]]);var P=Z;const I={class:"md:-w-1/2 mx-auto"},A={class:"-py-1"},G=(0,r.Uk)("Save"),J=(0,r.Uk)("cancel");function Q(e,n,t,o,a,s){const u=(0,r.up)("v-text-field"),d=(0,r.up)("v-combobox"),c=(0,r.up)("v-btn"),m=(0,r.up)("v-form");return(0,r.wg)(),(0,r.iD)("div",I,[(0,r._)("h2",null,(0,i.zw)(o.title),1),(0,r.Wm)(m,{novalidate:"",onSubmit:n[3]||(n[3]=(0,l.iM)((e=>o.onSave()),["prevent"])),modelValue:o.valid,"onUpdate:modelValue":n[4]||(n[4]=e=>o.valid=e),class:"-border -bg-gray-50 -p-1"},{default:(0,r.w5)((()=>[(0,r.Wm)(u,{id:"key",autofocus:"",class:"form-control",modelValue:o.link.key,"onUpdate:modelValue":n[0]||(n[0]=e=>o.link.key=e),placeholder:"Unique Key",disabled:!o.isNew,variant:"solo",label:"Key",rules:[e=>!!e||"Key is required"]},null,8,["modelValue","disabled","rules"]),(0,r.Wm)(u,{label:"Url",id:"url",class:"form-control",modelValue:o.link.url,"onUpdate:modelValue":n[1]||(n[1]=e=>o.link.url=e),variant:"solo",placeholder:"https://...",rules:[e=>!!e||"Url is required"]},null,8,["modelValue","rules"]),(0,r.Wm)(d,{label:"Domain",id:"domain",class:"form-control",modelValue:o.link.domain,"onUpdate:modelValue":n[2]||(n[2]=e=>o.link.domain=e),variant:"solo",disabled:!o.isNew,items:o.domains},null,8,["modelValue","disabled","items"]),(0,r._)("div",A,[(0,r.Wm)(c,{type:"submit",disabled:!o.valid,color:"success",class:"-mr-1"},{default:(0,r.w5)((()=>[G])),_:1},8,["disabled"]),(0,r.Wm)(c,{to:"/"},{default:(0,r.w5)((()=>[J])),_:1})])])),_:1},8,["modelValue"])])}var X={props:{editKey:{required:!1},domain:{required:!1}},setup(e){const n=(0,h.iH)({key:(0,h.iH)(""),url:(0,h.iH)(""),domain:(0,h.iH)("shawnl.ink")}),t=(0,h.iH)(["shawnl.ink","imfinel.ink","manenoughl.ink"]),l=(0,h.iH)("New Shawn Link"),i=(0,h.iH)(!0),o=(0,h.iH)(!1);async function a(){_.setBusy("Saving Link..."),_.clearError();try{if(i.value){const e=await w().post("/api/links",n.value);_.links.value.push(e.data),ye.push("/")}else{const t=_.links.value.find((n=>n.domain===e.domain));if(t){const l=t.links.findIndex((n=>n.key===e.editKey));if(l>=0){const e=t.links[l];if(e.key!=n.value.key||e.url!=n.value.url||e.domain!=n.value.domain){const e=await w().put("/api/links",n.value);_.links.value.splice(l,1,e)}else console.log("No change");ye.push("/")}else _.setError(`couldn't find key - internal error - ${old}`)}else _.setError("Couldn't find the domain in the collection")}}catch(t){_.setError(`Could not save: ${t}`)}finally{_.clearBusy()}}return(0,r.bv)((()=>{if(e.editKey){const t=_.links.value.find((n=>n.domain===e.domain));if(t){const r=t.links.find((n=>n.key===e.editKey));if(r)return i.value=!1,l.value="Editing Shawn Link",n.value.key=r.key,n.value.url=r.url,void(n.value.domain=r.domain)}_.error.value=`Can't Find the Key: ${e.editKey}`}})),{onSave:a,link:n,title:l,domains:t,isNew:i,valid:o}}};const ee=(0,U.Z)(X,[["render",Q]]);var ne=ee;const te=(0,r._)("h2",null,"Usage Report",-1),le={class:"-table-collapse -w-full"},re=(0,r._)("thead",null,[(0,r._)("tr",null,[(0,r._)("th",null,"Domain"),(0,r._)("th",null,"Short Code"),(0,r._)("th",null,"Count")])],-1),ie={class:"-border -border-gray-300 -p-1"},oe={class:"-border -border-gray-300 -p-1"},ae={class:"-border -border-gray-300 -p-1"};function se(e,n,t,l,o,a){return(0,r.wg)(),(0,r.iD)(r.HY,null,[te,(0,r._)("table",le,[re,(0,r._)("tbody",null,[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(e.summaries,(e=>((0,r.wg)(),(0,r.iD)("tr",{key:e.key,class:"hover:-bg-slate-100"},[(0,r._)("td",ie,(0,i.zw)(e.domain),1),(0,r._)("td",oe,(0,i.zw)(e.key),1),(0,r._)("td",ae,(0,i.zw)(e.clickCount),1)])))),128))])])],64)}var ue=(0,r.aZ)({name:"SummaryReport",setup(){const e=(0,h.qj)([]);return(0,r.bv)((async()=>{const n=await _.loadSummaries();e.splice(0,e.length,...n)})),{summaries:e}}});const de=(0,U.Z)(ue,[["render",se]]);var ce=de;const me=(e,n,t)=>{_.isLoaded.value?t():t("/")},fe=[{path:"/",name:"Home",component:P},{path:"/editor/:domain/:editKey",name:"EditLink",component:ne,props:!0,beforeEnter:me},{path:"/editor",name:"NewLink",component:ne,beforeEnter:me},{path:"/summaries",name:"Summaries",component:ce}],pe=(0,W.p7)({history:(0,W.r5)(),routes:fe});var ye=pe,ve=(t(9773),t(8957)),ke=t(1850),he=t(8600);(0,l.ri)(L).use(ye).use((0,ve.Rd)({components:ke,directives:he})).mount("#admin")}},n={};function t(l){var r=n[l];if(void 0!==r)return r.exports;var i=n[l]={exports:{}};return e[l](i,i.exports,t),i.exports}t.m=e,function(){var e=[];t.O=function(n,l,r,i){if(!l){var o=1/0;for(d=0;d<e.length;d++){l=e[d][0],r=e[d][1],i=e[d][2];for(var a=!0,s=0;s<l.length;s++)(!1&i||o>=i)&&Object.keys(t.O).every((function(e){return t.O[e](l[s])}))?l.splice(s--,1):(a=!1,i<o&&(o=i));if(a){e.splice(d--,1);var u=r();void 0!==u&&(n=u)}}return n}i=i||0;for(var d=e.length;d>0&&e[d-1][2]>i;d--)e[d]=e[d-1];e[d]=[l,r,i]}}(),function(){t.n=function(e){var n=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(n,{a:n}),n}}(),function(){t.d=function(e,n){for(var l in n)t.o(n,l)&&!t.o(e,l)&&Object.defineProperty(e,l,{enumerable:!0,get:n[l]})}}(),function(){t.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)}}(),function(){t.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={328:0};t.O.j=function(n){return 0===e[n]};var n=function(n,l){var r,i,o=l[0],a=l[1],s=l[2],u=0;if(o.some((function(n){return 0!==e[n]}))){for(r in a)t.o(a,r)&&(t.m[r]=a[r]);if(s)var d=s(t)}for(n&&n(l);u<o.length;u++)i=o[u],t.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return t.O(d)},l=self["webpackChunkclient"]=self["webpackChunkclient"]||[];l.forEach(n.bind(null,0)),l.push=n.bind(null,l.push.bind(l))}();var l=t.O(void 0,[998],(function(){return t(7123)}));l=t.O(l)})();
//# sourceMappingURL=admin.js.map